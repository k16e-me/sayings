---
import Lipsum from './Lipsum.astro'
import Icon from 'astro-icon'
import Fab from './Fab.astro'
const { book = '' } = Astro.props
---
<aside
    class="fixed inset-y-0 right-0 z-50 flex items-center ml-auto !m-0 h-screen opacity-0 translate-x-full transition duration-300 ease-in-out"
    data-chapters>
    <div class="bg-white w-[320px] sm:w-[392px] rounded-xl lg:rounded-2xl h-full max-h-[calc(100vh-80px)] mr-3 sm:mr-5 lg:mr-9 overflow-hidden">
        <div class="flex flex-col flex-shrink-0 overflow-hidden w-full h-full">
            <div class="bg-slate-100 flex items-center justify-between pr-5 shadow h-16">
                <h2 class="font-display text-xl p-5 h-full flex items-center text-slate-950">
                    Chapters <span class="sr-only">in { book }</span>
                </h2>
                <Fab id="close" small>
                    <Icon name="close" class="w-5"/>
                    <span class="sr-only">Close</span>
                </Fab>
            </div>
            <div class="flex-1 overflow-auto p-3">
                <slot/>
            </div>
        </div>
    </div>
</aside>

<script>
    const
        button = document.querySelector('[data-toggle-chapters]'),
        backdrop = document.querySelector('[data-backdrop]'),
        chapters = document.querySelector('[data-chapters]'),
        close = document.getElementById('close'),
        translateIn = ['translate-x-0', 'opacity-100'],
        translateOut = ['translate-x-full', 'opacity-0'],
        body = document.body,
        hidden = ['invisible']

    button.addEventListener('click', () => {
        body.style.overflow = 'hidden'
        backdrop.classList.remove('opacity-0')
        backdrop.classList.add('opacity-60')
        backdrop.classList.remove(...hidden)
        chapters.classList.add(...translateIn)
        chapters.classList.remove(...translateOut)
    })

    backdrop.addEventListener('click', () => removeSlideover())
    close.addEventListener('click', () => removeSlideover())

    function removeSlideover() {
        body.style.overflow = 'auto'
        backdrop.classList.add('opacity-0')
        backdrop.classList.remove('opacity-60')
        chapters.classList.remove(...translateIn)
        chapters.classList.add(...translateOut)
        setTimeout(() => {
            backdrop.classList.add(...hidden)
        }, 400)
    }
</script>