<script>
	import Swup from 'swup'
	import SwupProgressPlugin from '@swup/progress-plugin'
	import SwupA11yPlugin from '@swup/a11y-plugin'
	import SwupPreloadPlugin from '@swup/preload-plugin'
	import SwupScrollPlugin from '@swup/scroll-plugin'
	import Jumplink from '../js/jumplink'
	import Astrolog from '../js/astrolog'
	import { Silence, runAnimations } from '../js/gsap'
	import BackToTop from '../js/btt'
	import Slideover from '../js/slideover'
	import Toast from '../js/toast'
	import Search from '../js/search'
	import { body } from '../js/snips'

	const swup = new Swup({
		animationSelector: '[class*="swup-"]',
		animateHistoryBrowsing: true,
		plugins: [
			new SwupProgressPlugin({
				finishAnimation: false,
			}),
			new SwupA11yPlugin({
				respectReducedMotion: true,
				autofocus: true,
			}),
			new SwupPreloadPlugin({
				preloadVisibleLinks: true,
			}),
			new SwupScrollPlugin({
				doScrollingRightAway: true,
				offset: () =>
					document
						.querySelector('[data-main-header]')
						.getBoundingClientRect().height + 96,
			}),
		],
	})

	document.addEventListener('DOMContentLoaded', () => {
		init()
		once()
		body().removeAttribute('data-body-exit')
	})
	swup.hooks.on('page:view', () => init())

	function init() {
		Jumplink()
		Silence()
		BackToTop()
		Slideover()
		Toast()
		Search()
	}

	function once() {
		runAnimations()
		Astrolog()
	}
</script>