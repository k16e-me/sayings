---
import { useStoryblokApi } from '@storyblok/astro'
// import StoryblokComponent from '@storyblok/astro/components/StoryblokComponent.astro'
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'
import Layout from '../../layouts/Layout.astro'
import Wrapper from '../../layouts/Wrapper.astro'

export async function getStaticPaths() {
	const sbApi = useStoryblokApi()
	const { data } = await sbApi.get('cdn/stories/', {
		content_type: 'Collection',
		version: import.meta.env.DEV ? 'draft' : 'published',
	})

	const stories = Object.values(data.stories)

	return stories.map((s: any) => {
		return {
			params: { slug: s.slug },
		}
	})
}

const sbApi = useStoryblokApi()
const { slug } = Astro.params
const { data } = await sbApi.get(`cdn/stories/c/${slug}`, {
	version: import.meta.env.DEV ? 'draft' : 'published',
})
const page = data.story
---
<Layout pageTitle={ page.content.title }>
    <Wrapper>
        <StoryblokComponent blok={ page.content } />
    </Wrapper>
</Layout>